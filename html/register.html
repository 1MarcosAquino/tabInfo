<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Cadastrar</title>
    </head>
    <body>
        <div class="from-container">
            <div class="from-container-box">
                <h2>Cadastrar</h2>
                <form>
                    <div class="form-group">
                        <label for="name">Nome</label>
                        <input type="text" id="name" name="name" placeholder="Nome" required />
                    </div>

                    <div class="form-group">
                        <label for="password">Senha</label>
                        <input type="password" id="password" name="password" placeholder="Senha" required />
                    </div>

                    <div class="form-group">
                        <label for="contact">Contanto</label>
                        <input type="text" id="contact" name="contact" placeholder="Telefone ou e-mail" required />
                    </div>

                    <button class="button-info" onclick="register()" type="button">Cadastrar</button>
                    <p class="defult-link">JÃ¡ possui um conta? <a href="/login">Entrar</a></p>
                </form>

                <script>
                    function message(text, title = 'OPS', icon = 'question') {
                        Swal.fire({
                            title,
                            text,
                            icon,
                        }).then(() => {
                            if (title === 'PARABENS') {
                                window.location.href = '/dashboard';
                            }
                        });
                    }

                    function register() {
                        var name = $('#name').val();
                        var password = $('#password').val();
                        var contact = $('#contact').val();
                        var isValid = true;

                        if (name === '') {
                            message('Por favor, insira seu nome.');
                            isValid = false;
                        }

                        if (password === '') {
                            message('Por favor, insira sua senha.');
                            isValid = false;
                        }

                        if (contact === '') {
                            message('Por favor, insira seu contato (email ou telefone).');
                            isValid = false;
                        }

                        if (isValid) {
                            $.ajax({
                                url: '/user/register_user.php',
                                type: 'POST',
                                data: JSON.stringify({
                                    name: name,
                                    pass: password,
                                    contact: contact,
                                }),
                                success: function (response) {
                                    message('Cadastro bem-sucedido!', 'PARABENS');
                                    localStorage.setItem('user_email', response.result.email);
                                },
                                error: function (xhr, status, error) {
                                    console.log('Erro ao fazer cadastro: ' + error);
                                    message('Erro ao fazer cadastro');
                                },
                            });
                        }
                    }
                </script>
            </div>
        </div>
    </body>
</html>
